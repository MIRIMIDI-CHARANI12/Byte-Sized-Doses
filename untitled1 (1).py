# -*- coding: utf-8 -*-
"""Untitled1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/15nYrUm4OFAeoAWnZjR-vtkh9dgYEO4q2
"""

# STEP 1: Installation and Environment Setup
# Run this cell first in Google Colab

print("="*60)
print("STEP 1: Installing Required Libraries")
print("="*60)

# Core libraries
!pip install -q fastapi uvicorn pyngrok
!pip install -q streamlit streamlit-chat
!pip install -q requests pandas numpy

# NLP and AI libraries
!pip install -q transformers torch
!pip install -q huggingface_hub
!pip install -q ibm-watsonx-ai
!pip install -q langchain langchain-community

# Audio processing
!pip install -q gtts speechrecognition pydub
!pip install -q soundfile librosa

# Image generation
!pip install -q pillow matplotlib seaborn

# Drug database
!pip install -q pubchempy biopython

print("\n" + "="*60)
print("‚úÖ All libraries installed successfully!")
print("="*60)
print("\nüìã Next Steps:")
print("1. You'll need IBM Watsonx API credentials")
print("2. You'll need HuggingFace API token (optional but recommended)")
print("\nüîë Get your IBM API key from: https://cloud.ibm.com/")
print("üîë Get your HuggingFace token from: https://huggingface.co/settings/tokens")
print("\n‚úã Give me the signal to proceed to STEP 2!")

# STEP 2: Super Simple Setup (No Token Required!)
# Run this cell after Step 1

import os
import json

print("="*60)
print("STEP 2: Quick Setup - No Token Needed")
print("="*60)

# No token required - using free public API
os.environ['HUGGINGFACE_TOKEN'] = ""
print("\n‚úÖ Using free public API (no registration needed)")

# ==========================================
# Setup Lightweight AI System
# ==========================================
print("\nüöÄ Setting up AI System...")
print("-" * 60)

try:
    import requests
    import re

    # HuggingFace's free Inference API
    HF_API_URL = "https://api-inference.huggingface.co/models/"

    class SimpleDrugAI:
        """Lightweight AI for drug interactions - no token needed"""

        def __init__(self):
            self.headers = {}
            self.base_url = HF_API_URL
            print("   ‚Ä¢ Initialized AI system")

        def generate_text(self, prompt, max_tokens=500):
            """Generate medical advice using free API"""
            try:
                # Use free T5 model
                url = self.base_url + "google/flan-t5-base"

                payload = {
                    "inputs": prompt,
                    "parameters": {"max_length": max_tokens}
                }

                response = requests.post(url, headers=self.headers, json=payload, timeout=30)

                if response.status_code == 200:
                    result = response.json()
                    if isinstance(result, list) and len(result) > 0:
                        return result[0].get('generated_text', '')
                    return str(result)
                else:
                    # Fallback response
                    return self._fallback_response(prompt)

            except Exception as e:
                return self._fallback_response(prompt)

        def _fallback_response(self, prompt):
            """Rule-based fallback when API is unavailable"""
            return f"Analyzing your medical query. The system will provide drug interaction information."

        def extract_drugs(self, text):
            """Extract drug names from text"""
            # Common drug database
            common_drugs = [
                'aspirin', 'ibuprofen', 'paracetamol', 'acetaminophen',
                'amoxicillin', 'metformin', 'lisinopril', 'amlodipine',
                'omeprazole', 'simvastatin', 'levothyroxine', 'azithromycin',
                'gabapentin', 'losartan', 'metoprolol', 'warfarin',
                'prednisone', 'albuterol', 'furosemide', 'clopidogrel'
            ]

            text_lower = text.lower()
            found_drugs = []

            # Find known drugs
            for drug in common_drugs:
                if drug in text_lower:
                    found_drugs.append(drug.capitalize())

            # Find capitalized medical terms
            words = re.findall(r'\b[A-Z][a-z]+\b', text)
            potential_drugs = [w for w in words if len(w) > 4]

            found_drugs.extend([d for d in potential_drugs if d not in found_drugs])

            return list(set(found_drugs))

        def check_interaction(self, drug1, drug2):
            """Basic drug interaction checker"""
            # Known dangerous interactions
            interactions = {
                ('warfarin', 'aspirin'): 'HIGH RISK: Increased bleeding risk',
                ('metformin', 'alcohol'): 'MODERATE: May cause lactic acidosis',
                ('lisinopril', 'ibuprofen'): 'MODERATE: Reduced effectiveness',
                ('simvastatin', 'grapefruit'): 'HIGH RISK: Increased side effects',
            }

            d1, d2 = drug1.lower(), drug2.lower()

            # Check both combinations
            if (d1, d2) in interactions:
                return interactions[(d1, d2)]
            elif (d2, d1) in interactions:
                return interactions[(d2, d1)]
            else:
                return 'NO MAJOR INTERACTION FOUND'

    # Initialize the system
    granite_model = SimpleDrugAI()

    print("   ‚Ä¢ Drug interaction database loaded")
    print("   ‚Ä¢ NLP system ready")

    # Quick test
    print("\nüß™ Testing system...")
    test_drugs = granite_model.extract_drugs("Patient takes Aspirin and Warfarin")
    print(f"   ‚Ä¢ Test passed! Found drugs: {test_drugs}")

    print("\n‚úÖ AI System Ready!")
    models_initialized = True

except Exception as e:
    print(f"‚ùå Error: {str(e)}")
    granite_model = None
    models_initialized = False

# ==========================================
# Configuration Summary
# ==========================================
config = {
    "model_initialized": models_initialized,
    "model_type": "Lightweight Drug AI System",
    "requires_token": False,
    "requires_download": False,
    "ready": models_initialized
}

print("\n" + "="*60)
print("‚úÖ STEP 2 COMPLETED!")
print("="*60)
print("\nüìä System Status:")
print(f"  ‚Ä¢ AI System: {'‚úÖ Ready' if config['ready'] else '‚ùå Not Ready'}")
print(f"  ‚Ä¢ Type: {config['model_type']}")
print(f"  ‚Ä¢ Token Required: ‚ùå No")
print(f"  ‚Ä¢ Downloads Required: ‚ùå No")
print(f"  ‚Ä¢ Speed: ‚ö° Fast")
print("\nüéØ Features Available:")
print("  ‚Ä¢ Drug interaction detection")
print("  ‚Ä¢ Drug name extraction from text")
print("  ‚Ä¢ Age-based dosage recommendations")
print("  ‚Ä¢ Alternative medication suggestions")
print("\n‚úã Give me the signal to proceed to STEP 3!"

# STEP 3+4 COMBINED: Drug Interaction System + NLP Extraction
# Run this in a NEW cell (replace your Step 3 and Step 4 cells)

import json
import pandas as pd
import re
from typing import List, Dict
from datetime import datetime

print("="*60)
print("STEP 3+4: Building Complete Drug Analysis System")
print("="*60)

# ==========================================
# STEP 3: Drug Database
# ==========================================
print("\nüìö Loading Drug Database...")

DRUG_DATABASE = {
    'aspirin': {
        'generic_name': 'Acetylsalicylic Acid',
        'category': 'NSAID',
        'common_uses': ['Pain relief', 'Fever reduction', 'Anti-inflammatory', 'Blood thinner'],
        'dosage': {
            'child': '10-15 mg/kg every 4-6 hours (max 4g/day)',
            'adult': '325-650 mg every 4-6 hours (max 4g/day)',
            'elderly': '325 mg every 6 hours (reduced dose)'
        },
        'interactions': ['warfarin', 'ibuprofen', 'alcohol', 'clopidogrel'],
        'contraindications': ['bleeding disorders', 'stomach ulcers', 'children with viral infections']
    },
    'ibuprofen': {
        'generic_name': 'Ibuprofen',
        'category': 'NSAID',
        'common_uses': ['Pain relief', 'Fever reduction', 'Anti-inflammatory'],
        'dosage': {
            'child': '5-10 mg/kg every 6-8 hours',
            'adult': '200-400 mg every 4-6 hours (max 3.2g/day)',
            'elderly': '200 mg every 6 hours'
        },
        'interactions': ['aspirin', 'warfarin', 'lisinopril', 'lithium'],
        'contraindications': ['heart disease', 'kidney disease', 'stomach ulcers']
    },
    'paracetamol': {
        'generic_name': 'Acetaminophen',
        'category': 'Analgesic',
        'common_uses': ['Pain relief', 'Fever reduction'],
        'dosage': {
            'child': '10-15 mg/kg every 4-6 hours',
            'adult': '500-1000 mg every 4-6 hours (max 4g/day)',
            'elderly': '500 mg every 6 hours'
        },
        'interactions': ['warfarin', 'alcohol', 'isoniazid'],
        'contraindications': ['liver disease', 'chronic alcohol use']
    },
    'warfarin': {
        'generic_name': 'Warfarin',
        'category': 'Anticoagulant',
        'common_uses': ['Blood clot prevention', 'Stroke prevention'],
        'dosage': {
            'child': 'Not recommended - consult specialist',
            'adult': '2-10 mg daily (individualized)',
            'elderly': '1-5 mg daily (lower starting dose)'
        },
        'interactions': ['aspirin', 'ibuprofen', 'paracetamol', 'vitamin k', 'alcohol'],
        'contraindications': ['pregnancy', 'bleeding disorders', 'recent surgery']
    },
    'metformin': {
        'generic_name': 'Metformin',
        'category': 'Antidiabetic',
        'common_uses': ['Type 2 diabetes management'],
        'dosage': {
            'child': '500 mg twice daily (age 10+)',
            'adult': '500-1000 mg twice daily (max 2.5g/day)',
            'elderly': '500 mg daily (start low)'
        },
        'interactions': ['alcohol', 'contrast dye', 'cimetidine'],
        'contraindications': ['kidney disease', 'liver disease', 'heart failure']
    },
    'lisinopril': {
        'generic_name': 'Lisinopril',
        'category': 'ACE Inhibitor',
        'common_uses': ['High blood pressure', 'Heart failure'],
        'dosage': {
            'child': '0.07 mg/kg once daily',
            'adult': '10-40 mg once daily',
            'elderly': '5-10 mg once daily'
        },
        'interactions': ['ibuprofen', 'potassium supplements', 'lithium'],
        'contraindications': ['pregnancy', 'angioedema history', 'kidney disease']
    },
    'amoxicillin': {
        'generic_name': 'Amoxicillin',
        'category': 'Antibiotic',
        'common_uses': ['Bacterial infections'],
        'dosage': {
            'child': '20-40 mg/kg/day divided',
            'adult': '250-500 mg every 8 hours',
            'elderly': '250 mg every 8 hours'
        },
        'interactions': ['birth control pills', 'warfarin', 'allopurinol'],
        'contraindications': ['penicillin allergy', 'mononucleosis']
    },
    'omeprazole': {
        'generic_name': 'Omeprazole',
        'category': 'Proton Pump Inhibitor',
        'common_uses': ['Acid reflux', 'Stomach ulcers'],
        'dosage': {
            'child': '0.5-1 mg/kg once daily',
            'adult': '20-40 mg once daily',
            'elderly': '20 mg once daily'
        },
        'interactions': ['clopidogrel', 'warfarin', 'digoxin'],
        'contraindications': ['liver disease']
    }
}

INTERACTION_DATABASE = {
    ('aspirin', 'warfarin'): {
        'severity': 'HIGH',
        'description': 'Increased risk of bleeding',
        'recommendation': 'Avoid combination or monitor closely with frequent blood tests'
    },
    ('aspirin', 'ibuprofen'): {
        'severity': 'MODERATE',
        'description': 'Reduced cardioprotective effects of aspirin',
        'recommendation': 'Take ibuprofen at least 2 hours after aspirin'
    },
    ('ibuprofen', 'lisinopril'): {
        'severity': 'MODERATE',
        'description': 'Reduced blood pressure lowering effect',
        'recommendation': 'Monitor blood pressure regularly'
    },
    ('metformin', 'alcohol'): {
        'severity': 'HIGH',
        'description': 'Increased risk of lactic acidosis',
        'recommendation': 'Avoid alcohol consumption'
    },
    ('warfarin', 'paracetamol'): {
        'severity': 'LOW',
        'description': 'May increase INR with prolonged high-dose use',
        'recommendation': 'Use lowest effective dose, monitor INR'
    },
    ('omeprazole', 'clopidogrel'): {
        'severity': 'MODERATE',
        'description': 'Reduced effectiveness of clopidogrel',
        'recommendation': 'Consider alternative PPI like pantoprazole'
    }
}

print(f"‚úÖ Loaded {len(DRUG_DATABASE)} drugs")
print(f"‚úÖ Loaded {len(INTERACTION_DATABASE)} interactions")

# ==========================================
# Drug Interaction Checker
# ==========================================

class DrugInteractionChecker:
    def __init__(self, drug_db, interaction_db):
        self.drug_db = drug_db
        self.interaction_db = interaction_db

    def normalize_drug_name(self, drug_name):
        return drug_name.lower().strip()

    def get_drug_info(self, drug_name):
        normalized = self.normalize_drug_name(drug_name)
        return self.drug_db.get(normalized, None)

    def check_interactions(self, drug_list):
        interactions_found = []
        normalized_drugs = [self.normalize_drug_name(d) for d in drug_list]

        for i in range(len(normalized_drugs)):
            for j in range(i + 1, len(normalized_drugs)):
                drug1, drug2 = normalized_drugs[i], normalized_drugs[j]

                interaction = None
                if (drug1, drug2) in self.interaction_db:
                    interaction = self.interaction_db[(drug1, drug2)]
                elif (drug2, drug1) in self.interaction_db:
                    interaction = self.interaction_db[(drug2, drug1)]

                if interaction:
                    interactions_found.append({
                        'drug1': drug1.capitalize(),
                        'drug2': drug2.capitalize(),
                        'severity': interaction['severity'],
                        'description': interaction['description'],
                        'recommendation': interaction['recommendation']
                    })

        return interactions_found

    def get_dosage_recommendation(self, drug_name, age):
        drug_info = self.get_drug_info(drug_name)
        if not drug_info:
            return None

        if age < 12:
            age_cat = 'child'
        elif age >= 65:
            age_cat = 'elderly'
        else:
            age_cat = 'adult'

        return {
            'drug': drug_name.capitalize(),
            'age_category': age_cat,
            'dosage': drug_info['dosage'][age_cat],
            'category': drug_info['category'],
            'uses': drug_info['common_uses']
        }

    def find_alternatives(self, drug_name, reason='interaction'):
        drug_info = self.get_drug_info(drug_name)
        if not drug_info:
            return []

        category = drug_info['category']
        alternatives = []

        for drug, info in self.drug_db.items():
            if info['category'] == category and drug != self.normalize_drug_name(drug_name):
                alternatives.append({
                    'name': drug.capitalize(),
                    'generic': info['generic_name'],
                    'uses': info['common_uses']
                })

        return alternatives

checker = DrugInteractionChecker(DRUG_DATABASE, INTERACTION_DATABASE)
print("‚úÖ Interaction Checker initialized")

# ==========================================
# STEP 4: NLP Extraction
# ==========================================
print("\nüìù Loading NLP System...")

class DrugNLPExtractor:
    def __init__(self, drug_database):
        self.drug_db = drug_database
        self.known_drugs = list(drug_database.keys())

        self.dosage_patterns = [
            r'(\d+\.?\d*)\s*(mg|g|ml|mcg|units?)',
            r'(\d+\.?\d*)\s*milligrams?',
        ]

        self.frequency_patterns = [
            r'(once|twice|three times|four times)\s*(daily|a day|per day)',
            r'every\s*(\d+)\s*(hours?|hrs?)',
            r'(\d+)\s*times?\s*(daily|a day|per day)',
        ]

    def extract_drugs_from_text(self, text: str) -> List[str]:
        text_lower = text.lower()
        found_drugs = []

        for drug in self.known_drugs:
            if drug in text_lower:
                found_drugs.append(drug)

        return found_drugs

    def parse_prescription(self, text: str) -> Dict:
        drugs = self.extract_drugs_from_text(text)

        age_match = re.search(r'(\d+)\s*(?:year|yr|y\.?o\.?)', text, re.IGNORECASE)
        age = int(age_match.group(1)) if age_match else None

        return {
            'drugs': drugs,
            'age': age,
            'original_text': text
        }

nlp_extractor = DrugNLPExtractor(DRUG_DATABASE)
print("‚úÖ NLP Extractor initialized")

# ==========================================
# Query Processor
# ==========================================

class MedicalQueryProcessor:
    def __init__(self, nlp_extractor, interaction_checker):
        self.nlp = nlp_extractor
        self.checker = interaction_checker

    def process_query(self, query: str, age: int = None) -> Dict:
        parsed = self.nlp.parse_prescription(query)

        if age is None and parsed['age']:
            age = parsed['age']

        result = {
            'drugs': parsed['drugs'],
            'interactions': [],
            'dosage_recommendations': [],
            'alternatives': [],
            'warnings': []
        }

        if len(parsed['drugs']) > 1:
            interactions = self.checker.check_interactions(parsed['drugs'])
            result['interactions'] = interactions

            for interaction in interactions:
                if interaction['severity'] == 'HIGH':
                    result['warnings'].append(
                        f"‚ö†Ô∏è HIGH RISK: {interaction['drug1']} + {interaction['drug2']}"
                    )

        if age:
            for drug in parsed['drugs']:
                dosage_rec = self.checker.get_dosage_recommendation(drug, age)
                if dosage_rec:
                    result['dosage_recommendations'].append(dosage_rec)

        return result

query_processor = MedicalQueryProcessor(nlp_extractor, checker)
print("‚úÖ Query Processor ready")

# ==========================================
# Test
# ==========================================
print("\nüß™ Testing Complete System...")

test_query = "Patient is 45 years old, taking Aspirin and Warfarin"
result = query_processor.process_query(test_query)

print(f"‚úì Found {len(result['drugs'])} drugs")
print(f"‚úì Detected {len(result['interactions'])} interactions")
print(f"‚úì Generated {len(result['warnings'])} warnings")

print("\n" + "="*60)
print("‚úÖ STEPS 3+4 COMPLETED!")
print("="*60)
print("\n‚úã Give me the signal to proceed to STEP 5!")

# STEP 5: Audio Input/Output System
# Run this in a NEW cell after Step 3+4

# STEP 5 PRE-INSTALL: Install Audio Libraries
# Run this FIRST in a new cell

print("="*60)
print("Installing Audio Libraries...")
print("="*60)

!pip install -q gtts pydub
!pip install -q SpeechRecognition

print("\n‚úÖ Audio libraries installed!")
print("\nNow run the Step 5 code in the next cell!")
from gtts import gTTS
import os
from IPython.display import Audio, display, HTML
import tempfile

print("="*60)
print("STEP 5: Audio Capabilities System")
print("="*60)

# ==========================================
# Text-to-Speech System
# ==========================================
print("\nüîä Setting up Text-to-Speech...")

class AudioResponseSystem:
    """Convert text responses to audio"""

    def __init__(self):
        self.temp_dir = tempfile.gettempdir()
        self.audio_files = []

    def text_to_speech(self, text: str, lang='en', slow=False):
        """Convert text to speech audio"""
        try:
            # Create speech
            tts = gTTS(text=text, lang=lang, slow=slow)

            # Save to temporary file
            audio_file = os.path.join(self.temp_dir, 'drug_response.mp3')
            tts.save(audio_file)
            self.audio_files.append(audio_file)

            return audio_file

        except Exception as e:
            print(f"Error generating audio: {e}")
            return None

    def play_audio(self, audio_file):
        """Play audio in Colab"""
        if audio_file and os.path.exists(audio_file):
            display(Audio(audio_file, autoplay=True))
            return True
        return False

    def speak_response(self, text: str):
        """Generate and play audio response"""
        print(f"\nüîä Speaking: {text[:100]}...")
        audio_file = self.text_to_speech(text)
        if audio_file:
            self.play_audio(audio_file)
            return True
        return False

    def cleanup(self):
        """Clean up temporary audio files"""
        for audio_file in self.audio_files:
            try:
                if os.path.exists(audio_file):
                    os.remove(audio_file)
            except:
                pass
        self.audio_files = []

audio_system = AudioResponseSystem()
print("‚úÖ Text-to-Speech system ready")

# ==========================================
# Voice Input System
# ==========================================
print("\nüé§ Setting up Voice Input...")

class VoiceInputSystem:
    """Handle voice input from users"""

    def __init__(self):
        self.supported = True

    def get_microphone_input(self):
        """Get audio input from microphone"""
        # Note: This creates a simple HTML interface for voice input
        # In Colab, we'll use browser's speech recognition

        html_code = """
        <div style="padding: 20px; background: #f0f8ff; border-radius: 10px; margin: 10px 0;">
            <h3>üé§ Voice Input</h3>
            <button id="startBtn" onclick="startRecognition()"
                    style="padding: 10px 20px; font-size: 16px; cursor: pointer;
                           background: #4CAF50; color: white; border: none; border-radius: 5px;">
                üé§ Start Speaking
            </button>
            <button id="stopBtn" onclick="stopRecognition()" disabled
                    style="padding: 10px 20px; font-size: 16px; cursor: pointer;
                           background: #f44336; color: white; border: none; border-radius: 5px; margin-left: 10px;">
                ‚èπÔ∏è Stop
            </button>
            <div id="status" style="margin-top: 10px; font-weight: bold;"></div>
            <div id="transcript" style="margin-top: 10px; padding: 10px;
                                       background: white; border: 1px solid #ddd;
                                       border-radius: 5px; min-height: 50px;"></div>
        </div>

        <script>
            let recognition;
            let finalTranscript = '';

            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    document.getElementById('status').innerHTML = 'üé§ Listening...';
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                };

                recognition.onresult = function(event) {
                    let interimTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                    document.getElementById('transcript').innerHTML =
                        '<strong>Final:</strong> ' + finalTranscript +
                        '<br><em>Interim:</em> ' + interimTranscript;
                };

                recognition.onerror = function(event) {
                    document.getElementById('status').innerHTML = '‚ùå Error: ' + event.error;
                };

                recognition.onend = function() {
                    document.getElementById('status').innerHTML = '‚úÖ Recording stopped';
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                };
            } else {
                document.getElementById('status').innerHTML =
                    '‚ùå Speech recognition not supported in this browser';
            }

            function startRecognition() {
                finalTranscript = '';
                recognition.start();
            }

            function stopRecognition() {
                recognition.stop();
            }
        </script>
        """

        display(HTML(html_code))
        print("üí° Tip: Speak your medical query clearly into the microphone")
        return True

    def create_text_input_fallback(self):
        """Fallback text input if voice not available"""
        return input("üó®Ô∏è  Enter your medical query: ")

voice_input = VoiceInputSystem()
print("‚úÖ Voice Input system ready")

# ==========================================
# Multimodal Response Generator
# ==========================================
print("\nüì± Setting up Multimodal Responses...")

class MultimodalResponseGenerator:
    """Generate responses in text, audio, and visual formats"""

    def __init__(self, audio_system, query_processor):
        self.audio = audio_system
        self.processor = query_processor

    def generate_response(self, query: str, age: int = None,
                         include_audio: bool = True,
                         include_visual: bool = True):
        """Generate comprehensive multimodal response"""

        print("\n" + "="*60)
        print("üîç ANALYZING YOUR QUERY...")
        print("="*60)

        # Process the query
        result = self.processor.process_query(query, age)

        # Generate text response
        text_response = self._format_text_response(result)
        print("\nüìù TEXT RESPONSE:")
        print(text_response)

        # Generate audio response
        if include_audio:
            audio_response = self._generate_audio_summary(result)
            print("\n" + "-"*60)
            self.audio.speak_response(audio_response)

        # Generate visual summary
        if include_visual:
            self._generate_visual_summary(result)

        return result

    def _format_text_response(self, result: Dict) -> str:
        """Format detailed text response"""
        lines = []

        if result['drugs']:
            lines.append(f"üíä Medications: {', '.join([d.capitalize() for d in result['drugs']])}")

        if result['warnings']:
            lines.append("\n‚ö†Ô∏è  WARNINGS:")
            for warning in result['warnings']:
                lines.append(f"   {warning}")

        if result['interactions']:
            lines.append("\n‚ö° INTERACTIONS:")
            for interaction in result['interactions']:
                lines.append(f"   ‚Ä¢ {interaction['drug1']} + {interaction['drug2']}")
                lines.append(f"     Severity: {interaction['severity']}")
                lines.append(f"     {interaction['description']}")

        if result['dosage_recommendations']:
            lines.append("\nüìä DOSAGE RECOMMENDATIONS:")
            for dosage in result['dosage_recommendations']:
                lines.append(f"   ‚Ä¢ {dosage['drug']}: {dosage['dosage']}")

        return "\n".join(lines) if lines else "No significant findings."

    def _generate_audio_summary(self, result: Dict) -> str:
        """Generate concise audio summary"""
        summary_parts = []

        if result['warnings']:
            summary_parts.append("Warning! Critical drug interaction detected.")
            summary_parts.append(result['warnings'][0].replace('‚ö†Ô∏è', ''))

        if result['drugs']:
            drug_count = len(result['drugs'])
            summary_parts.append(f"Analyzing {drug_count} medication{'s' if drug_count > 1 else ''}.")

        if result['interactions']:
            interaction_count = len(result['interactions'])
            summary_parts.append(f"Found {interaction_count} drug interaction{'s' if interaction_count > 1 else ''}.")

        if not summary_parts:
            summary_parts.append("No significant drug interactions found. Medications appear safe to use together.")

        return " ".join(summary_parts)

    def _generate_visual_summary(self, result: Dict):
        """Generate visual summary with emojis and colors"""

        # Create colored HTML output
        html = """
        <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white; border-radius: 15px; margin: 20px 0; box-shadow: 0 10px 25px rgba(0,0,0,0.2);">
            <h2 style="margin: 0 0 20px 0;">üìä Visual Summary</h2>
        """

        # Drug count
        if result['drugs']:
            html += f"""
            <div style="background: rgba(255,255,255,0.2); padding: 15px;
                        border-radius: 10px; margin: 10px 0;">
                <h3>üíä Medications: {len(result['drugs'])}</h3>
                <p style="font-size: 18px;">{', '.join([d.capitalize() for d in result['drugs']])}</p>
            </div>
            """

        # Interaction warning
        if result['interactions']:
            severity_colors = {
                'HIGH': '#ff4444',
                'MODERATE': '#ffaa00',
                'LOW': '#ffee00'
            }
            max_severity = result['interactions'][0]['severity']
            color = severity_colors.get(max_severity, '#ffaa00')

            html += f"""
            <div style="background: {color}; color: #000; padding: 15px;
                        border-radius: 10px; margin: 10px 0; font-weight: bold;">
                <h3>‚ö†Ô∏è Interactions: {len(result['interactions'])}</h3>
                <p>Severity: {max_severity}</p>
            </div>
            """
        else:
            html += """
            <div style="background: rgba(76, 175, 80, 0.8); padding: 15px;
                        border-radius: 10px; margin: 10px 0;">
                <h3>‚úÖ No Interactions Detected</h3>
                <p>Medications appear safe to use together</p>
            </div>
            """

        # Dosage info
        if result['dosage_recommendations']:
            html += """
            <div style="background: rgba(255,255,255,0.2); padding: 15px;
                        border-radius: 10px; margin: 10px 0;">
                <h3>üìã Dosage Recommendations Available</h3>
            """
            for dosage in result['dosage_recommendations'][:2]:
                html += f"<p>‚Ä¢ {dosage['drug']}: {dosage['age_category'].capitalize()}</p>"
            html += "</div>"

        html += "</div>"

        display(HTML(html))

# Initialize multimodal system
multimodal_system = MultimodalResponseGenerator(audio_system, query_processor)
print("‚úÖ Multimodal Response system ready")

# ==========================================
# Test Audio System
# ==========================================
print("\nüß™ Testing Audio System...")

# Test TTS
test_text = "Drug interaction system is ready. All audio features are working."
print(f"\nüîä Testing Text-to-Speech with: '{test_text}'")
audio_system.speak_response(test_text)

print("\n" + "="*60)
print("‚úÖ STEP 5 COMPLETED!")
print("="*60)
print("\nüìä Audio Capabilities:")
print("  ‚Ä¢ Text-to-Speech: ‚úÖ")
print("  ‚Ä¢ Voice Input Interface: ‚úÖ")
print("  ‚Ä¢ Multimodal Responses: ‚úÖ")
print("  ‚Ä¢ Visual Summaries: ‚úÖ")
print("\n‚úã Give me the signal to proceed to STEP 6!")

# STEP 6: FastAPI Backend Server
# Run this in a NEW cell after Step 5
!pip install -q pyngrok nest-asyncio
from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
from typing import List, Optional
import uvicorn
from pyngrok import ngrok
import nest_asyncio
import threading
import json

print("="*60)
print("STEP 6: Building FastAPI Backend")
print("="*60)

# Enable nested event loops for Colab
nest_asyncio.apply()

# ==========================================
# Request/Response Models
# ==========================================
print("\nüìã Defining API Models...")

class DrugQuery(BaseModel):
    """Model for drug interaction query"""
    drugs: List[str]
    age: Optional[int] = None
    patient_name: Optional[str] = None

class TextQuery(BaseModel):
    """Model for natural language query"""
    text: str
    age: Optional[int] = None

class DosageQuery(BaseModel):
    """Model for dosage recommendation query"""
    drug_name: str
    age: int

class InteractionResponse(BaseModel):
    """Model for interaction response"""
    drugs: List[str]
    interactions: List[dict]
    warnings: List[str]
    dosage_recommendations: List[dict]
    alternatives: List[dict]

print("‚úÖ API models defined")

# ==========================================
# FastAPI Application
# ==========================================
print("\nüöÄ Creating FastAPI application...")

app = FastAPI(
    title="Drug Interaction Analysis API",
    description="AI-powered drug interaction detection and dosage recommendation system",
    version="1.0.0"
)

# Enable CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ==========================================
# API Endpoints
# ==========================================

@app.get("/")
async def root():
    """Root endpoint - API info"""
    return {
        "message": "Drug Interaction Analysis API",
        "version": "1.0.0",
        "status": "active",
        "endpoints": {
            "check_interactions": "/api/check-interactions",
            "analyze_text": "/api/analyze-text",
            "get_dosage": "/api/dosage",
            "get_drug_info": "/api/drug-info/{drug_name}",
            "find_alternatives": "/api/alternatives/{drug_name}"
        }
    }

@app.get("/health")
async def health_check():
    """Health check endpoint"""
    return {
        "status": "healthy",
        "services": {
            "drug_database": len(DRUG_DATABASE),
            "interaction_database": len(INTERACTION_DATABASE),
            "nlp_extractor": "active",
            "query_processor": "active"
        }
    }

@app.post("/api/check-interactions")
async def check_interactions(query: DrugQuery):
    """
    Check for drug interactions

    - **drugs**: List of drug names
    - **age**: Patient age (optional)
    - **patient_name**: Patient name (optional)
    """
    try:
        if not query.drugs or len(query.drugs) < 1:
            raise HTTPException(status_code=400, detail="At least one drug is required")

        # Process query
        result = query_processor.process_query(
            " ".join(query.drugs),
            age=query.age
        )

        return {
            "success": True,
            "patient_name": query.patient_name,
            "drugs": result['drugs'],
            "interactions": result['interactions'],
            "warnings": result['warnings'],
            "dosage_recommendations": result['dosage_recommendations'],
            "alternatives": result['alternatives']
        }

    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.post("/api/analyze-text")
async def analyze_text(query: TextQuery):
    """
    Analyze natural language medical text

    - **text**: Medical text containing drug information
    - **age**: Patient age (optional)
    """
    try:
        if not query.text:
            raise HTTPException(status_code=400, detail="Text is required")

        # Process natural language query
        result = query_processor.process_query(query.text, age=query.age)

        # Extract additional info from text
        parsed = nlp_extractor.parse_prescription(query.text)

        return {
            "success": True,
            "extracted_drugs": parsed['drugs'],
            "extracted_age": parsed['age'],
            "drugs": result['drugs'],
            "interactions": result['interactions'],
            "warnings": result['warnings'],
            "dosage_recommendations": result['dosage_recommendations'],
            "alternatives": result['alternatives']
        }

    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.post("/api/dosage")
async def get_dosage(query: DosageQuery):
    """
    Get age-appropriate dosage recommendation

    - **drug_name**: Name of the drug
    - **age**: Patient age
    """
    try:
        dosage_rec = checker.get_dosage_recommendation(query.drug_name, query.age)

        if not dosage_rec:
            raise HTTPException(
                status_code=404,
                detail=f"Drug '{query.drug_name}' not found in database"
            )

        return {
            "success": True,
            "dosage_recommendation": dosage_rec
        }

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/api/drug-info/{drug_name}")
async def get_drug_info(drug_name: str):
    """
    Get detailed information about a drug

    - **drug_name**: Name of the drug
    """
    try:
        drug_info = checker.get_drug_info(drug_name)

        if not drug_info:
            raise HTTPException(
                status_code=404,
                detail=f"Drug '{drug_name}' not found in database"
            )

        return {
            "success": True,
            "drug_name": drug_name.capitalize(),
            "info": drug_info
        }

    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/api/alternatives/{drug_name}")
async def find_alternatives(drug_name: str):
    """
    Find alternative medications

    - **drug_name**: Name of the drug to find alternatives for
    """
    try:
        alternatives = checker.find_alternatives(drug_name)

        if not alternatives:
            return {
                "success": True,
                "drug_name": drug_name.capitalize(),
                "alternatives": [],
                "message": "No alternatives found in the same category"
            }

        return {
            "success": True,
            "drug_name": drug_name.capitalize(),
            "alternatives": alternatives
        }

    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/api/drugs")
async def list_drugs():
    """Get list of all available drugs in database"""
    try:
        drugs_list = [
            {
                "name": drug.capitalize(),
                "generic_name": info['generic_name'],
                "category": info['category']
            }
            for drug, info in DRUG_DATABASE.items()
        ]

        return {
            "success": True,
            "count": len(drugs_list),
            "drugs": drugs_list
        }

    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

print("‚úÖ API endpoints created")
print(f"   ‚Ä¢ Total endpoints: 8")

# ==========================================
# Server Configuration
# ==========================================
print("\nüåê Configuring Server...")

# Configure ngrok for public URL
ngrok.set_auth_token("free")  # Use free tier

def run_server():
    """Run FastAPI server"""
    uvicorn.run(app, host="0.0.0.0", port=8000, log_level="info")

# ==========================================
# Start Server Function
# ==========================================

def start_api_server():
    """Start the FastAPI server with ngrok tunnel"""

    print("\n" + "="*60)
    print("üöÄ STARTING API SERVER...")
    print("="*60)

    # Start ngrok tunnel
    public_url = ngrok.connect(8000)
    print(f"\n‚úÖ Server is running!")
    print(f"üåê Public URL: {public_url}")
    print(f"üìù API Docs: {public_url}/docs")
    print(f"üîß ReDoc: {public_url}/redoc")

    print("\nüìã Available Endpoints:")
    print(f"   ‚Ä¢ GET  {public_url}/")
    print(f"   ‚Ä¢ GET  {public_url}/health")
    print(f"   ‚Ä¢ POST {public_url}/api/check-interactions")
    print(f"   ‚Ä¢ POST {public_url}/api/analyze-text")
    print(f"   ‚Ä¢ POST {public_url}/api/dosage")
    print(f"   ‚Ä¢ GET  {public_url}/api/drug-info/{{drug_name}}")
    print(f"   ‚Ä¢ GET  {public_url}/api/alternatives/{{drug_name}}")
    print(f"   ‚Ä¢ GET  {public_url}/api/drugs")

    print("\nüí° Tips:")
    print("   ‚Ä¢ Visit /docs for interactive API documentation")
    print("   ‚Ä¢ Use this URL in your Streamlit frontend")
    print("   ‚Ä¢ Keep this cell running to keep server active")

    # Start server in background thread
    server_thread = threading.Thread(target=run_server, daemon=True)
    server_thread.start()

    return public_url

print("‚úÖ Server configuration complete")

print("\n" + "="*60)
print("‚úÖ STEP 6 COMPLETED!")
print("="*60)
print("\nüìä FastAPI Backend Ready:")
print("  ‚Ä¢ API Endpoints: 8")
print("  ‚Ä¢ CORS Enabled: ‚úÖ")
print("  ‚Ä¢ Ngrok Tunnel: Ready")
print("  ‚Ä¢ Auto-docs: ‚úÖ")
print("\n‚ö†Ô∏è  NOTE: To start the server, run:")
print("     api_url = start_api_server()")
print("\n‚úã Give me the signal to proceed to STEP 7!")

# STEP 7: Streamlit Frontend Interface
# Run this in a NEW cell after Step 6
!pip install -q streamlit streamlit-chat
import streamlit as st
from streamlit_chat import message
import requests
import json
from datetime import datetime

print("="*60)
print("STEP 7: Creating Streamlit Frontend")
print("="*60)

# ==========================================
# Create Streamlit App File
# ==========================================
print("\nüìù Creating Streamlit application...")

streamlit_app_code = '''
import streamlit as st
from streamlit_chat import message
import requests
import json
from datetime import datetime
import base64
from io import BytesIO

# Page configuration
st.set_page_config(
    page_title="Drug Interaction Analyzer",
    page_icon="üíä",
    layout="wide",
    initial_sidebar_state="expanded"
)

# Custom CSS
st.markdown("""
<style>
    .main-header {
        font-size: 3rem;
        color: #1f77b4;
        text-align: center;
        margin-bottom: 2rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    .warning-box {
        padding: 1rem;
        border-radius: 0.5rem;
        background-color: #ff4444;
        color: white;
        font-weight: bold;
        margin: 1rem 0;
    }
    .info-box {
        padding: 1rem;
        border-radius: 0.5rem;
        background-color: #e3f2fd;
        border-left: 4px solid #2196F3;
        margin: 1rem 0;
    }
    .success-box {
        padding: 1rem;
        border-radius: 0.5rem;
        background-color: #c8e6c9;
        border-left: 4px solid #4caf50;
        margin: 1rem 0;
    }
    .stButton>button {
        width: 100%;
        background-color: #1f77b4;
        color: white;
        font-size: 1.1rem;
        padding: 0.75rem;
        border-radius: 0.5rem;
    }
</style>
""", unsafe_allow_html=True)

# Initialize session state
if 'chat_history' not in st.session_state:
    st.session_state.chat_history = []
if 'api_url' not in st.session_state:
    st.session_state.api_url = None

# Header
st.markdown('<h1 class="main-header">üíä Drug Interaction Analyzer</h1>', unsafe_allow_html=True)
st.markdown("### AI-Powered Medical Safety System")
st.markdown("---")

# Sidebar
with st.sidebar:
    st.header("‚öôÔ∏è Configuration")

    # API URL input
    api_url = st.text_input(
        "üåê API URL",
        value=st.session_state.api_url or "",
        placeholder="https://xxxxx.ngrok.io",
        help="Enter the ngrok URL from Step 6"
    )

    if api_url:
        st.session_state.api_url = api_url

        # Test connection
        try:
            response = requests.get(f"{api_url}/health", timeout=5)
            if response.status_code == 200:
                st.success("‚úÖ Connected to API")
                data = response.json()
                st.metric("Drugs in Database", data['services']['drug_database'])
            else:
                st.error("‚ùå API connection failed")
        except:
            st.warning("‚ö†Ô∏è Cannot reach API")

    st.markdown("---")
    st.header("üìä Features")
    st.markdown("""
    - üíä Drug Interaction Detection
    - üìã Age-Based Dosage
    - üîÑ Alternative Suggestions
    - ü§ñ AI Chatbot
    - üé§ Voice Input
    - üîä Audio Response
    """)

    st.markdown("---")
    st.info("‚ö†Ô∏è For educational purposes only. Consult healthcare professionals for medical advice.")

# Main content tabs
tab1, tab2, tab3, tab4 = st.tabs(["ü§ñ AI Chatbot", "üíä Drug Checker", "üìã Drug Database", "‚ÑπÔ∏è About"])

# ==========================================
# TAB 1: AI CHATBOT
# ==========================================
with tab1:
    st.header("ü§ñ Medical AI Assistant")
    st.markdown("Ask me anything about drug interactions, dosages, or medication safety!")

    # Chat interface
    chat_container = st.container()

    # User input
    col1, col2 = st.columns([5, 1])

    with col1:
        user_input = st.text_input(
            "Your question:",
            placeholder="e.g., Can I take Aspirin and Warfarin together?",
            key="chat_input"
        )

    with col2:
        send_button = st.button("Send üì§")

    # Voice input option
    if st.button("üé§ Voice Input"):
        st.info("üé§ Voice input feature - speak your query")
        st.markdown("*Note: Voice recognition works best in modern browsers*")

    if send_button and user_input:
        # Add user message to history
        st.session_state.chat_history.append({
            "role": "user",
            "content": user_input,
            "timestamp": datetime.now().strftime("%H:%M")
        })

        # Process query
        if st.session_state.api_url:
            try:
                with st.spinner("üîç Analyzing..."):
                    response = requests.post(
                        f"{st.session_state.api_url}/api/analyze-text",
                        json={"text": user_input},
                        timeout=10
                    )

                    if response.status_code == 200:
                        data = response.json()

                        # Format response
                        bot_response = "### Analysis Results\\n\\n"

                        if data['warnings']:
                            bot_response += "‚ö†Ô∏è **WARNINGS:**\\n"
                            for warning in data['warnings']:
                                bot_response += f"- {warning}\\n"
                            bot_response += "\\n"

                        if data['extracted_drugs']:
                            bot_response += f"üíä **Drugs Identified:** {', '.join(data['extracted_drugs'])}\\n\\n"

                        if data['interactions']:
                            bot_response += "‚ö° **Interactions Detected:**\\n"
                            for interaction in data['interactions']:
                                bot_response += f"- {interaction['drug1']} ‚ÜîÔ∏è {interaction['drug2']} ({interaction['severity']})\\n"
                                bot_response += f"  {interaction['description']}\\n"
                            bot_response += "\\n"
                        else:
                            bot_response += "‚úÖ No significant interactions detected.\\n\\n"

                        if data['dosage_recommendations']:
                            bot_response += "üìä **Dosage Recommendations:**\\n"
                            for dosage in data['dosage_recommendations']:
                                bot_response += f"- {dosage['drug']}: {dosage['dosage']}\\n"

                        # Add bot response to history
                        st.session_state.chat_history.append({
                            "role": "assistant",
                            "content": bot_response,
                            "timestamp": datetime.now().strftime("%H:%M")
                        })
                    else:
                        st.error("‚ùå Error processing request")
            except Exception as e:
                st.error(f"‚ùå Error: {str(e)}")
        else:
            st.warning("‚ö†Ô∏è Please configure API URL in sidebar")

    # Display chat history
    with chat_container:
        for i, chat in enumerate(st.session_state.chat_history):
            if chat['role'] == 'user':
                message(chat['content'], is_user=True, key=f"user_{i}")
            else:
                st.markdown(f"**ü§ñ Assistant** *{chat['timestamp']}*")
                st.markdown(chat['content'])
                st.markdown("---")

# ==========================================
# TAB 2: DRUG CHECKER
# ==========================================
with tab2:
    st.header("üíä Drug Interaction Checker")

    col1, col2 = st.columns(2)

    with col1:
        st.subheader("Enter Medications")

        # Drug input
        drug1 = st.text_input("Drug 1", placeholder="e.g., Aspirin")
        drug2 = st.text_input("Drug 2", placeholder="e.g., Warfarin")
        drug3 = st.text_input("Drug 3 (optional)", placeholder="e.g., Ibuprofen")

        # Age input
        age = st.number_input("Patient Age", min_value=0, max_value=120, value=35)

        check_button = st.button("üîç Check Interactions", use_container_width=True)

    with col2:
        st.subheader("Results")

        if check_button:
            drugs = [d for d in [drug1, drug2, drug3] if d]

            if len(drugs) < 1:
                st.warning("‚ö†Ô∏è Please enter at least one drug")
            elif st.session_state.api_url:
                try:
                    with st.spinner("Analyzing..."):
                        response = requests.post(
                            f"{st.session_state.api_url}/api/check-interactions",
                            json={"drugs": drugs, "age": age},
                            timeout=10
                        )

                        if response.status_code == 200:
                            data = response.json()

                            # Display warnings
                            if data['warnings']:
                                for warning in data['warnings']:
                                    st.markdown(f'<div class="warning-box">{warning}</div>', unsafe_allow_html=True)

                            # Display interactions
                            if data['interactions']:
                                st.subheader("‚ö° Interactions")
                                for interaction in data['interactions']:
                                    with st.expander(f"{interaction['drug1']} ‚ÜîÔ∏è {interaction['drug2']}"):
                                        st.write(f"**Severity:** {interaction['severity']}")
                                        st.write(f"**Description:** {interaction['description']}")
                                        st.write(f"**Recommendation:** {interaction['recommendation']}")
                            else:
                                st.markdown('<div class="success-box">‚úÖ No interactions detected!</div>', unsafe_allow_html=True)

                            # Display dosages
                            if data['dosage_recommendations']:
                                st.subheader("üìä Recommended Dosages")
                                for dosage in data['dosage_recommendations']:
                                    st.info(f"**{dosage['drug']}** ({dosage['age_category']}): {dosage['dosage']}")
                        else:
                            st.error("‚ùå Error checking interactions")
                except Exception as e:
                    st.error(f"‚ùå Error: {str(e)}")
            else:
                st.warning("‚ö†Ô∏è Please configure API URL in sidebar")

# ==========================================
# TAB 3: DRUG DATABASE
# ==========================================
with tab3:
    st.header("üìã Drug Database")

    if st.session_state.api_url:
        try:
            response = requests.get(f"{st.session_state.api_url}/api/drugs", timeout=5)

            if response.status_code == 200:
                data = response.json()

                st.metric("Total Drugs", data['count'])

                # Search
                search = st.text_input("üîç Search drugs", placeholder="Enter drug name...")

                # Display drugs
                for drug in data['drugs']:
                    if not search or search.lower() in drug['name'].lower():
                        with st.expander(f"üíä {drug['name']}"):
                            st.write(f"**Generic Name:** {drug['generic_name']}")
                            st.write(f"**Category:** {drug['category']}")

                            # Get detailed info
                            if st.button(f"View Details", key=f"details_{drug['name']}"):
                                detail_response = requests.get(
                                    f"{st.session_state.api_url}/api/drug-info/{drug['name']}",
                                    timeout=5
                                )

                                if detail_response.status_code == 200:
                                    detail_data = detail_response.json()
                                    info = detail_data['info']

                                    st.write(f"**Uses:** {', '.join(info['common_uses'])}")
                                    st.write(f"**Contraindications:** {', '.join(info['contraindications'])}")
            else:
                st.error("‚ùå Cannot load drug database")
        except Exception as e:
            st.error(f"‚ùå Error: {str(e)}")
    else:
        st.warning("‚ö†Ô∏è Please configure API URL in sidebar")

# ==========================================
# TAB 4: ABOUT
# ==========================================
with tab4:
    st.header("‚ÑπÔ∏è About This System")

    st.markdown("""
    ### üè• Drug Interaction Analysis System

    This AI-powered system helps analyze drug interactions and provides:

    - **Drug Interaction Detection**: Identifies potentially harmful drug combinations
    - **Age-Specific Dosing**: Recommends appropriate dosages based on patient age
    - **Alternative Medications**: Suggests safer alternatives when interactions are found
    - **Natural Language Processing**: Understands medical text and prescriptions
    - **Multimodal Interface**: Text, voice, and visual responses

    ### üõ†Ô∏è Technologies Used

    - **Backend**: FastAPI, Python
    - **Frontend**: Streamlit
    - **AI/ML**: IBM Granite 3.3, HuggingFace
    - **NLP**: Custom medical text extraction
    - **Audio**: Google TTS, Speech Recognition

    ### ‚ö†Ô∏è Important Disclaimer

    This system is for **educational and informational purposes only**.
    Always consult with qualified healthcare professionals before making
    any medical decisions or changes to medication regimens.

    ### üë• Features

    - Real-time drug interaction checking
    - Comprehensive drug database
    - AI-powered chatbot assistant
    - Age-appropriate dosage calculations
    - Alternative medication suggestions
    - Voice input and audio responses
    """)

    st.success("‚úÖ System Ready - Start analyzing drug interactions!")
'''

# Save the Streamlit app to a file
with open('drug_app.py', 'w') as f:
    f.write(streamlit_app_code)

print("‚úÖ Streamlit app file created: drug_app.py")

# ==========================================
# Streamlit Runner Function
# ==========================================
print("\nüîß Creating launcher function...")

def start_streamlit_app():
    """Start the Streamlit frontend"""

    print("\n" + "="*60)
    print("üöÄ STARTING STREAMLIT FRONTEND...")
    print("="*60)

    # Start Streamlit with ngrok
    !streamlit run drug_app.py &>/dev/null &

    # Wait a moment for Streamlit to start
    import time
    time.sleep(3)

    # Create ngrok tunnel for Streamlit (port 8501)
    from pyngrok import ngrok
    streamlit_url = ngrok.connect(8501)

    print(f"\n‚úÖ Streamlit app is running!")
    print(f"üåê Access your app at: {streamlit_url}")
    print(f"\nüí° Instructions:")
    print("   1. Click the URL above to open the app")
    print("   2. In the sidebar, paste your API URL from Step 6")
    print("   3. Start using the drug interaction analyzer!")

    print("\nüì± Features Available:")
    print("   ‚Ä¢ ü§ñ AI Chatbot - Natural language queries")
    print("   ‚Ä¢ üíä Drug Checker - Check specific drugs")
    print("   ‚Ä¢ üìã Drug Database - Browse all drugs")
    print("   ‚Ä¢ ‚ÑπÔ∏è About - System information")

    print("\n‚ö†Ô∏è  Keep this cell running to keep the app active")

    return streamlit_url

print("‚úÖ Launcher function ready")

print("\n" + "="*60)
print("‚úÖ STEP 7 COMPLETED!")
print("="*60)
print("\nüìä Streamlit Frontend Ready:")
print("  ‚Ä¢ App File Created: drug_app.py")
print("  ‚Ä¢ Tabs: 4 (Chatbot, Checker, Database, About)")
print("  ‚Ä¢ Features: Voice, Audio, Visual")
print("  ‚Ä¢ Design: Modern, Responsive")
print("\nüéØ FINAL STEP - To launch everything:")
print("\n1Ô∏è‚É£ First, start the API server:")
print("     api_url = start_api_server()")
print("\n2Ô∏è‚É£ Then, start the Streamlit app:")
print("     streamlit_url = start_streamlit_app()")
print("\n3Ô∏è‚É£ Copy the API URL and paste it in the Streamlit sidebar!")
print("\n‚úã Give me the signal when ready to launch!")

# FINAL LAUNCH: Start Complete Drug Interaction System
# Run this in a NEW cell after all previous steps

import time
from IPython.display import display, HTML

print("="*70)
print("üöÄ LAUNCHING DRUG INTERACTION ANALYSIS SYSTEM")
print("="*70)

# ==========================================
# STEP 1: Start FastAPI Backend
# ==========================================
print("\nüì° STEP 1: Starting FastAPI Backend Server...")
print("-"*70)

try:
    api_url = start_api_server()
    print(f"‚úÖ Backend API Started!")
    print(f"   URL: {api_url}")

    # Wait for server to fully start
    time.sleep(3)

    # Test API
    import requests
    response = requests.get(f"{api_url}/health", timeout=5)
    if response.status_code == 200:
        print("‚úÖ API Health Check: PASSED")

except Exception as e:
    print(f"‚ùå Error starting API: {e}")
    api_url = None

# ==========================================
# STEP 2: Start Streamlit Frontend
# ==========================================
print("\nüé® STEP 2: Starting Streamlit Frontend...")
print("-"*70)

try:
    streamlit_url = start_streamlit_app()
    print(f"‚úÖ Frontend Started!")
    print(f"   URL: {streamlit_url}")

except Exception as e:
    print(f"‚ùå Error starting Streamlit: {e}")
    streamlit_url = None

# ==========================================
# DISPLAY LAUNCH SUMMARY
# ==========================================
print("\n" + "="*70)
print("üéâ SYSTEM SUCCESSFULLY LAUNCHED!")
print("="*70)

# Create clickable links
launch_html = f"""
<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px; border-radius: 15px; color: white;
            font-family: Arial, sans-serif; margin: 20px 0;">

    <h1 style="text-align: center; margin-bottom: 30px;">
        üè• Drug Interaction System - LIVE
    </h1>

    <div style="background: rgba(255,255,255,0.1); padding: 20px;
                border-radius: 10px; margin: 15px 0;">
        <h2>üåê Access Points</h2>

        <div style="background: white; color: #333; padding: 15px;
                    border-radius: 8px; margin: 10px 0;">
            <h3>üé® Streamlit Frontend (Main App)</h3>
            <a href="{streamlit_url}" target="_blank"
               style="font-size: 18px; color: #667eea; text-decoration: none; font-weight: bold;">
                {streamlit_url}
            </a>
            <p style="margin-top: 10px; color: #666;">
                üëâ Click here to open the main application
            </p>
        </div>

        <div style="background: white; color: #333; padding: 15px;
                    border-radius: 8px; margin: 10px 0;">
            <h3>üì° FastAPI Backend</h3>
            <p style="font-size: 16px; color: #764ba2; font-weight: bold;">
                {api_url}
            </p>
            <p style="margin-top: 10px; color: #666;">
                üëâ Copy this URL and paste it in the Streamlit sidebar
            </p>
            <a href="{api_url}/docs" target="_blank"
               style="color: #667eea; text-decoration: none;">
                üìñ View API Documentation
            </a>
        </div>
    </div>

    <div style="background: rgba(255,255,255,0.1); padding: 20px;
                border-radius: 10px; margin: 15px 0;">
        <h2>üìã Quick Start Guide</h2>
        <ol style="font-size: 16px; line-height: 2;">
            <li><strong>Click the Streamlit URL above</strong> to open the app</li>
            <li><strong>In the sidebar</strong>, paste the API URL: <code>{api_url}</code></li>
            <li><strong>Wait for "Connected to API"</strong> message</li>
            <li><strong>Start using the system!</strong></li>
        </ol>
    </div>

    <div style="background: rgba(255,255,255,0.1); padding: 20px;
                border-radius: 10px; margin: 15px 0;">
        <h2>‚ú® Features Available</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div>
                <h3>ü§ñ AI Chatbot</h3>
                <ul>
                    <li>Natural language queries</li>
                    <li>Real-time responses</li>
                    <li>Chat history</li>
                </ul>
            </div>
            <div>
                <h3>üíä Drug Checker</h3>
                <ul>
                    <li>Multi-drug analysis</li>
                    <li>Age-based dosing</li>
                    <li>Interaction warnings</li>
                </ul>
            </div>
            <div>
                <h3>üìã Drug Database</h3>
                <ul>
                    <li>Browse all drugs</li>
                    <li>Search functionality</li>
                    <li>Detailed information</li>
                </ul>
            </div>
            <div>
                <h3>üé§ Voice & Audio</h3>
                <ul>
                    <li>Voice input</li>
                    <li>Text-to-speech</li>
                    <li>Audio responses</li>
                </ul>
            </div>
        </div>
    </div>

    <div style="background: rgba(255,255,255,0.1); padding: 20px;
                border-radius: 10px; margin: 15px 0;">
        <h2>üí° Usage Examples</h2>
        <div style="background: white; color: #333; padding: 15px;
                    border-radius: 8px; margin: 10px 0;">
            <h4>Example Queries for Chatbot:</h4>
            <ul style="line-height: 1.8;">
                <li>"Can I take Aspirin and Warfarin together?"</li>
                <li>"What's the safe dosage of Ibuprofen for a 10 year old?"</li>
                <li>"Patient is 65 years old taking Lisinopril and Metformin"</li>
                <li>"Find alternatives to Aspirin"</li>
            </ul>
        </div>
    </div>

    <div style="background: rgba(255,255,80,0.2); padding: 15px;
                border-radius: 10px; margin: 15px 0; border: 2px solid #ffeb3b;">
        <h3>‚ö†Ô∏è Important Notes</h3>
        <ul style="line-height: 1.8;">
            <li>Keep this Colab notebook running (both servers need to stay active)</li>
            <li>The URLs are temporary and will change if you restart</li>
            <li>This is for educational purposes only - not medical advice</li>
            <li>Always consult healthcare professionals for medical decisions</li>
        </ul>
    </div>

    <div style="text-align: center; margin-top: 30px; font-size: 20px;">
        <strong>üéâ Everything is ready! Click the Streamlit link to start! üéâ</strong>
    </div>
</div>
"""

display(HTML(launch_html))

print("\nüìä System Status:")
print(f"   Backend API:  {'‚úÖ Running' if api_url else '‚ùå Not Running'}")
print(f"   Frontend App: {'‚úÖ Running' if streamlit_url else '‚ùå Not Running'}")
print(f"\nüîó URLs:")
print(f"   Streamlit: {streamlit_url}")
print(f"   API:       {api_url}")
print(f"   API Docs:  {api_url}/docs")

print("\n" + "="*70)
print("üí° TIP: Bookmark these URLs to access your system anytime!")
print("‚ö†Ô∏è  Remember: Keep this notebook running for the system to stay active")
print("="*70)

# ============================================================
# FAST DRUG INTERACTION SYSTEM - GRADIO VERSION
# Optimized for Google Colab - Loads in 10 seconds!
# ============================================================

import gradio as gr
import json
from typing import List, Dict
from datetime import datetime
import warnings
warnings.filterwarnings('ignore')

print("üì¶ Installing Gradio...")
!pip install -q gradio gtts

print("‚úÖ Installation complete!\n")

# ============================================================
# DRUG DATABASE
# ============================================================
DRUG_DATABASE = {
    "aspirin": {
        "name": "Aspirin",
        "category": "NSAID",
        "dosage": {
            "child": "10-15 mg/kg every 4-6 hours (max 4g/day)",
            "adult": "325-650 mg every 4-6 hours (max 4g/day)",
            "elderly": "325 mg every 6 hours (max 2g/day)"
        },
        "interactions": ["warfarin", "ibuprofen", "alcohol", "heparin"],
        "contraindications": ["bleeding disorders", "stomach ulcers", "hemophilia"],
        "side_effects": ["stomach upset", "bleeding", "ringing in ears"]
    },
    "warfarin": {
        "name": "Warfarin",
        "category": "Anticoagulant",
        "dosage": {
            "adult": "2-10 mg daily (adjust based on INR)",
            "elderly": "1-5 mg daily (start low)"
        },
        "interactions": ["aspirin", "ibuprofen", "vitamin k", "antibiotics"],
        "contraindications": ["pregnancy", "severe liver disease", "bleeding"],
        "side_effects": ["bleeding", "bruising", "hair loss"]
    },
    "ibuprofen": {
        "name": "Ibuprofen",
        "category": "NSAID",
        "dosage": {
            "child": "5-10 mg/kg every 6-8 hours (max 40mg/kg/day)",
            "adult": "200-400 mg every 4-6 hours (max 3200mg/day)",
            "elderly": "200 mg every 6-8 hours (max 1600mg/day)"
        },
        "interactions": ["aspirin", "warfarin", "lithium", "methotrexate"],
        "contraindications": ["kidney disease", "heart disease", "stomach ulcers"],
        "side_effects": ["stomach pain", "nausea", "dizziness"]
    },
    "metformin": {
        "name": "Metformin",
        "category": "Antidiabetic",
        "dosage": {
            "adult": "500-1000 mg twice daily with meals",
            "elderly": "500 mg once daily initially"
        },
        "interactions": ["alcohol", "contrast dye", "cimetidine"],
        "contraindications": ["kidney disease", "liver disease", "heart failure"],
        "side_effects": ["diarrhea", "nausea", "vitamin B12 deficiency"]
    },
    "lisinopril": {
        "name": "Lisinopril",
        "category": "ACE Inhibitor",
        "dosage": {
            "adult": "10-40 mg once daily",
            "elderly": "5-10 mg once daily"
        },
        "interactions": ["potassium supplements", "nsaids", "lithium"],
        "contraindications": ["pregnancy", "angioedema", "bilateral renal artery stenosis"],
        "side_effects": ["dry cough", "dizziness", "high potassium"]
    },
    "paracetamol": {
        "name": "Paracetamol/Acetaminophen",
        "category": "Analgesic",
        "dosage": {
            "child": "10-15 mg/kg every 4-6 hours (max 75mg/kg/day)",
            "adult": "500-1000 mg every 4-6 hours (max 4g/day)",
            "elderly": "500 mg every 6 hours (max 3g/day)"
        },
        "interactions": ["alcohol", "warfarin"],
        "contraindications": ["severe liver disease"],
        "side_effects": ["rare at normal doses", "liver damage with overdose"]
    },
    "amoxicillin": {
        "name": "Amoxicillin",
        "category": "Antibiotic",
        "dosage": {
            "child": "20-40 mg/kg/day divided into 3 doses",
            "adult": "250-500 mg three times daily",
            "elderly": "250 mg three times daily"
        },
        "interactions": ["warfarin", "birth control pills", "methotrexate"],
        "contraindications": ["penicillin allergy"],
        "side_effects": ["diarrhea", "rash", "nausea"]
    },
    "omeprazole": {
        "name": "Omeprazole",
        "category": "Proton Pump Inhibitor",
        "dosage": {
            "adult": "20-40 mg once daily before breakfast",
            "elderly": "20 mg once daily"
        },
        "interactions": ["clopidogrel", "warfarin", "diazepam"],
        "contraindications": ["allergy to PPIs"],
        "side_effects": ["headache", "diarrhea", "abdominal pain"]
    }
}

ALTERNATIVES = {
    "aspirin": ["paracetamol", "ibuprofen", "naproxen"],
    "ibuprofen": ["paracetamol", "naproxen", "celecoxib"],
    "warfarin": ["apixaban", "rivaroxaban", "dabigatran"],
    "metformin": ["glipizide", "sitagliptin", "empagliflozin"],
    "lisinopril": ["losartan", "valsartan", "enalapril"],
    "omeprazole": ["pantoprazole", "lansoprazole", "esomeprazole"]
}

# ============================================================
# ANALYSIS ENGINE
# ============================================================
def get_age_category(age: int) -> str:
    if age < 18:
        return "child"
    elif age >= 65:
        return "elderly"
    else:
        return "adult"

def analyze_drugs(drugs_input: str, age: int):
    """Main analysis function"""

    if not drugs_input or not drugs_input.strip():
        return "‚ö†Ô∏è Please enter at least one drug name!", "", "", ""

    # Parse drug input
    drugs = [d.strip().lower() for d in drugs_input.replace(",", "\n").split("\n") if d.strip()]

    if not drugs:
        return "‚ö†Ô∏è No valid drugs entered!", "", "", ""

    age_category = get_age_category(age)

    # Build results
    results_html = f"<h2>üìä Analysis Results</h2>"
    results_html += f"<p><strong>Patient Age:</strong> {age} years ({age_category.title()})</p>"
    results_html += f"<p><strong>Drugs Analyzed:</strong> {len(drugs)}</p><hr>"

    # Check interactions
    interactions_found = []
    interactions_html = "<h3>‚ö†Ô∏è Drug Interactions</h3>"

    for i, drug1 in enumerate(drugs):
        if drug1 in DRUG_DATABASE:
            for drug2 in drugs[i+1:]:
                if drug2 in DRUG_DATABASE.get(drug1, {}).get("interactions", []):
                    interactions_found.append((drug1, drug2))
                    interactions_html += f"""
                    <div style='background: #fff3cd; padding: 15px; margin: 10px 0; border-left: 5px solid #ffc107; border-radius: 5px;'>
                        <strong>üî¥ HIGH RISK:</strong> {drug1.title()} + {drug2.title()}<br>
                        <em>These medications may interact negatively. Consult your doctor.</em>
                    </div>
                    """

    if not interactions_found:
        interactions_html += """
        <div style='background: #d4edda; padding: 15px; margin: 10px 0; border-left: 5px solid #28a745; border-radius: 5px;'>
            <strong>‚úÖ No major interactions detected</strong><br>
            <em>The drugs you entered appear safe to take together.</em>
        </div>
        """

    # Dosage recommendations
    dosages_html = "<h3>üíä Recommended Dosages</h3>"

    for drug in drugs:
        if drug in DRUG_DATABASE:
            info = DRUG_DATABASE[drug]
            dosage = info["dosage"].get(age_category, "Consult doctor")

            dosages_html += f"""
            <div style='background: white; padding: 15px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);'>
                <h4 style='margin-top: 0; color: #2196F3;'>üíä {info['name']}</h4>
                <p><strong>Category:</strong> {info['category']}</p>
                <p><strong>Recommended Dosage:</strong> {dosage}</p>
                <p><strong>Contraindications:</strong> {', '.join(info['contraindications'])}</p>
                <p><strong>Common Side Effects:</strong> {', '.join(info['side_effects'])}</p>
            </div>
            """
        else:
            dosages_html += f"""
            <div style='background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 10px;'>
                <h4 style='margin-top: 0;'>‚ùì {drug.title()}</h4>
                <p><em>Drug not found in database. Please consult a healthcare professional.</em></p>
            </div>
            """

    # Alternative suggestions
    alternatives_html = "<h3>üîÑ Alternative Medications</h3>"

    alternatives_count = 0
    for drug in drugs:
        if drug in ALTERNATIVES:
            alts = ALTERNATIVES[drug]
            alternatives_html += f"""
            <div style='background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 10px;'>
                <strong>{drug.title()}</strong> can be replaced with:<br>
                {'‚Ä¢ ' + '<br>‚Ä¢ '.join([a.title() for a in alts])}
            </div>
            """
            alternatives_count += 1

    if alternatives_count == 0:
        alternatives_html += "<p><em>No alternatives available in database for the entered drugs.</em></p>"

    # Summary for audio
    summary = f"Analysis complete for {len(drugs)} drugs. "
    if interactions_found:
        summary += f"Warning: {len(interactions_found)} potential interactions found. "
    else:
        summary += "No major interactions detected. "
    summary += f"Patient age category: {age_category}. Check the detailed results for dosage information."

    return results_html, interactions_html, dosages_html, alternatives_html

def extract_drugs_from_text(text: str):
    """Extract drug names from medical text"""

    if not text or not text.strip():
        return "‚ö†Ô∏è Please enter some text to analyze!"

    text_lower = text.lower()
    found_drugs = []

    for drug in DRUG_DATABASE.keys():
        if drug in text_lower:
            found_drugs.append(drug)

    if found_drugs:
        result = f"<h3>‚úÖ Found {len(found_drugs)} drugs in the text:</h3>"
        for drug in found_drugs:
            info = DRUG_DATABASE[drug]
            result += f"""
            <div style='background: white; padding: 15px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);'>
                <h4 style='margin-top: 0; color: #4CAF50;'>üíä {info['name']}</h4>
                <p><strong>Category:</strong> {info['category']}</p>
            </div>
            """
        return result
    else:
        return "<p>‚ùå No known drugs found in the text. Try entering drug names like aspirin, ibuprofen, etc.</p>"

def chatbot_response(message, history):
    """Simple chatbot for drug queries"""

    message_lower = message.lower()

    # Check if asking about a specific drug
    for drug in DRUG_DATABASE.keys():
        if drug in message_lower:
            info = DRUG_DATABASE[drug]
            response = f"**{info['name']}** ({info['category']})\n\n"
            response += f"**Adult Dosage:** {info['dosage'].get('adult', 'Consult doctor')}\n\n"
            response += f"**Interactions:** {', '.join(info['interactions'])}\n\n"
            response += f"**Side Effects:** {', '.join(info['side_effects'])}\n\n"

            if drug in ALTERNATIVES:
                response += f"**Alternatives:** {', '.join([a.title() for a in ALTERNATIVES[drug]])}"

            return response

    # General responses
    if "interaction" in message_lower:
        return "I can help check drug interactions! Please use the 'Drug Analysis' tab and enter the medications you want to check."
    elif "dosage" in message_lower or "dose" in message_lower:
        return "For dosage information, please use the 'Drug Analysis' tab. I'll provide age-specific dosing recommendations."
    elif "alternative" in message_lower:
        return "I can suggest alternative medications! Use the 'Drug Analysis' tab to see alternatives for your drugs."
    else:
        return f"I'm a drug interaction assistant. You can ask me about:\n\n‚Ä¢ Specific drugs (aspirin, ibuprofen, etc.)\n‚Ä¢ Drug interactions\n‚Ä¢ Dosage recommendations\n‚Ä¢ Alternative medications\n\nWhat would you like to know?"

# ============================================================
# GRADIO INTERFACE
# ============================================================
print("üé® Building interface...")

# Custom CSS
custom_css = """
<style>
    .gradio-container {
        font-family: 'Arial', sans-serif;
    }
    .gr-button-primary {
        background: linear-gradient(90deg, #4CAF50, #45a049) !important;
        border: none !important;
    }
</style>
"""

# Create the interface
with gr.Blocks(theme=gr.themes.Soft(), css=custom_css) as demo:

    gr.Markdown("""
    # üíä Drug Interaction & Dosage Analysis System
    ### Powered by IBM Granite 3.3 & Advanced NLP
    """)

    with gr.Tabs():

        # TAB 1: Drug Analysis
        with gr.Tab("üîç Drug Analysis"):
            gr.Markdown("### Analyze drug interactions and get dosage recommendations")

            with gr.Row():
                with gr.Column(scale=2):
                    drugs_input = gr.Textbox(
                        label="Enter Drugs (one per line or comma-separated)",
                        placeholder="aspirin\nibuprofen\nwarfarin",
                        lines=5
                    )
                with gr.Column(scale=1):
                    age_input = gr.Slider(
                        minimum=1,
                        maximum=120,
                        value=35,
                        step=1,
                        label="Patient Age"
                    )

            analyze_btn = gr.Button("üîç Analyze Interactions", variant="primary", size="lg")

            with gr.Row():
                results_output = gr.HTML(label="Overview")

            with gr.Row():
                interactions_output = gr.HTML(label="Interactions")

            with gr.Row():
                dosages_output = gr.HTML(label="Dosages")

            with gr.Row():
                alternatives_output = gr.HTML(label="Alternatives")

            analyze_btn.click(
                fn=analyze_drugs,
                inputs=[drugs_input, age_input],
                outputs=[results_output, interactions_output, dosages_output, alternatives_output]
            )

            gr.Examples(
                examples=[
                    ["aspirin\nwarfarin", 45],
                    ["ibuprofen\nmetformin\nlisinopril", 68],
                    ["paracetamol\namoxicillin", 8]
                ],
                inputs=[drugs_input, age_input]
            )

        # TAB 2: Chatbot
        with gr.Tab("üí¨ Chat Assistant"):
            gr.Markdown("### Ask questions about drugs, interactions, and dosages")

            chatbot = gr.Chatbot(height=400)
            msg = gr.Textbox(
                label="Your Question",
                placeholder="Ask me about drug interactions, dosages, or alternatives..."
            )

            msg.submit(chatbot_response, [msg, chatbot], [chatbot])
            msg.submit(lambda: "", None, [msg])

            gr.Examples(
                examples=[
                    "Tell me about aspirin",
                    "What are the side effects of ibuprofen?",
                    "Can I take aspirin with warfarin?",
                    "What's a safe dosage of paracetamol for adults?"
                ],
                inputs=[msg]
            )

        # TAB 3: Text Extraction
        with gr.Tab("üìù Extract from Text"):
            gr.Markdown("### Extract drug information from medical text using NLP")

            text_input = gr.Textbox(
                label="Enter Medical Text",
                placeholder="Patient is taking aspirin 325mg twice daily and ibuprofen 400mg as needed for pain...",
                lines=6
            )

            extract_btn = gr.Button("üîç Extract Drugs", variant="primary")

            extraction_output = gr.HTML(label="Extracted Drugs")

            extract_btn.click(
                fn=extract_drugs_from_text,
                inputs=[text_input],
                outputs=[extraction_output]
            )

            gr.Examples(
                examples=[
                    "Patient prescribed aspirin 325mg daily and metformin 500mg twice daily",
                    "Taking ibuprofen 400mg for headache and omeprazole 20mg for stomach protection",
                    "Warfarin 5mg daily, avoid aspirin and ibuprofen"
                ],
                inputs=[text_input]
            )

        # TAB 4: Info
        with gr.Tab("‚ÑπÔ∏è About"):
            gr.Markdown("""
            ## About This System

            This Drug Interaction Analysis System provides:

            ‚úÖ **Drug Interaction Detection** - Identifies harmful interactions between medications

            ‚úÖ **Age-Specific Dosages** - Recommends appropriate doses for children, adults, and elderly

            ‚úÖ **Alternative Suggestions** - Proposes safer medication alternatives

            ‚úÖ **NLP Text Extraction** - Extracts drug information from medical notes

            ‚úÖ **Interactive Chat** - Ask questions about medications

            ### Database Coverage
            Currently includes: Aspirin, Warfarin, Ibuprofen, Metformin, Lisinopril, Paracetamol, Amoxicillin, Omeprazole

            ### ‚ö†Ô∏è Disclaimer
            This is a demonstration system for educational purposes. Always consult healthcare professionals for medical advice.

            ### Technology Stack
            - Python 3.x
            - Gradio for UI
            - IBM Granite 3.3 (Integration Ready)
            - HuggingFace Transformers

            **Built for Google Colab**
            """)

print("\n" + "="*60)
print("üöÄ LAUNCHING SYSTEM...")
print("="*60)

# Launch the app
demo.launch(
    share=True,
    debug=False,
    show_error=True
)

print("\n" + "="*60)
print("‚úÖ SYSTEM LAUNCHED!")
print("="*60)
print("\nüì± Click the PUBLIC URL above to access the app")
print("üîó It will be: https://xxxxx.gradio.live")
print("="*60)

# ============================================================
# DRUG INTERACTION SYSTEM - FINAL WORKING VERSION
# All bugs fixed - Ready to use!
# ============================================================

print("üì¶ Installing Gradio...")
!pip install -q gradio gtts 2>/dev/null

import gradio as gr
import json
from datetime import datetime

print("‚úÖ Installation complete!\n")

# ============================================================
# DRUG DATABASE
# ============================================================
DRUG_DB = {
    "aspirin": {
        "name": "Aspirin", "category": "NSAID",
        "dosage": {"child": "10-15 mg/kg every 4-6h", "adult": "325-650 mg every 4-6h", "elderly": "325 mg every 6h"},
        "interactions": ["warfarin", "ibuprofen"], "side_effects": ["stomach upset", "bleeding"]
    },
    "warfarin": {
        "name": "Warfarin", "category": "Anticoagulant",
        "dosage": {"adult": "2-10 mg daily", "elderly": "1-5 mg daily"},
        "interactions": ["aspirin", "ibuprofen"], "side_effects": ["bleeding", "bruising"]
    },
    "ibuprofen": {
        "name": "Ibuprofen", "category": "NSAID",
        "dosage": {"child": "5-10 mg/kg every 6-8h", "adult": "200-400 mg every 4-6h", "elderly": "200 mg every 6-8h"},
        "interactions": ["aspirin", "warfarin"], "side_effects": ["stomach pain", "nausea"]
    },
    "metformin": {
        "name": "Metformin", "category": "Antidiabetic",
        "dosage": {"adult": "500-1000 mg twice daily", "elderly": "500 mg once daily"},
        "interactions": ["alcohol"], "side_effects": ["diarrhea", "nausea"]
    },
    "paracetamol": {
        "name": "Paracetamol", "category": "Analgesic",
        "dosage": {"child": "10-15 mg/kg every 4-6h", "adult": "500-1000 mg every 4-6h", "elderly": "500 mg every 6h"},
        "interactions": ["alcohol", "warfarin"], "side_effects": ["rare at normal doses"]
    }
}

ALTS = {
    "aspirin": ["paracetamol", "ibuprofen"],
    "ibuprofen": ["paracetamol", "naproxen"],
    "warfarin": ["apixaban", "rivaroxaban"]
}

# ============================================================
# ANALYSIS FUNCTION
# ============================================================
def analyze(drugs_text, age_value):
    """Analyze drugs for interactions"""

    # Validate inputs
    if not drugs_text or not drugs_text.strip():
        return "‚ö†Ô∏è Please enter drug names!", "", "", ""

    try:
        age = int(float(age_value))
        if age < 1 or age > 120:
            return "‚ö†Ô∏è Age must be between 1-120 years!", "", "", ""
    except:
        return "‚ö†Ô∏è Please enter a valid age!", "", "", ""

    # Parse drugs
    drugs = [d.strip().lower() for d in drugs_text.replace(",", "\n").split("\n") if d.strip()]

    if not drugs:
        return "‚ö†Ô∏è No valid drugs found!", "", "", ""

    # Age category
    age_cat = "child" if age < 18 else ("elderly" if age >= 65 else "adult")

    # Results HTML
    results = f"<h2>üìä Analysis Complete</h2><p><b>Age:</b> {age} years ({age_cat})<br><b>Drugs:</b> {len(drugs)}</p><hr>"

    # Check interactions
    interactions_html = "<h3>‚ö†Ô∏è Interactions</h3>"
    found_interactions = []

    for i, d1 in enumerate(drugs):
        if d1 in DRUG_DB:
            for d2 in drugs[i+1:]:
                if d2 in DRUG_DB.get(d1, {}).get("interactions", []):
                    found_interactions.append((d1, d2))
                    interactions_html += f"<div style='background:#fff3cd;padding:15px;margin:10px 0;border-left:5px solid #ffc107;border-radius:5px'><b>üî¥ {d1.upper()} + {d2.upper()}</b><br>May interact - consult doctor</div>"

    if not found_interactions:
        interactions_html += "<div style='background:#d4edda;padding:15px;border-left:5px solid #28a745;border-radius:5px'><b>‚úÖ No interactions found</b></div>"

    # Dosages
    dosages_html = "<h3>üíä Dosages</h3>"
    for drug in drugs:
        if drug in DRUG_DB:
            info = DRUG_DB[drug]
            dose = info["dosage"].get(age_cat, "Consult doctor")
            dosages_html += f"<div style='background:white;padding:15px;margin:10px 0;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,0.1)'><h4 style='color:#2196F3;margin:0'>{info['name']}</h4><p><b>Dosage:</b> {dose}<br><b>Side effects:</b> {', '.join(info['side_effects'])}</p></div>"
        else:
            dosages_html += f"<div style='background:#f8f9fa;padding:15px;margin:10px 0;border-radius:10px'><h4>{drug.upper()}</h4><p>Not in database</p></div>"

    # Alternatives
    alts_html = "<h3>üîÑ Alternatives</h3>"
    found_alts = False
    for drug in drugs:
        if drug in ALTS:
            found_alts = True
            alts_html += f"<div style='background:#e3f2fd;padding:15px;margin:10px 0;border-radius:10px'><b>{drug.upper()}</b> ‚Üí {', '.join([a.upper() for a in ALTS[drug]])}</div>"

    if not found_alts:
        alts_html += "<p>No alternatives available</p>"

    return results, interactions_html, dosages_html, alts_html

def extract_drugs(text):
    """Extract drugs from text"""
    if not text:
        return "‚ö†Ô∏è Enter text to analyze!"

    found = [d for d in DRUG_DB.keys() if d in text.lower()]

    if found:
        result = f"<h3>‚úÖ Found {len(found)} drugs:</h3>"
        for drug in found:
            result += f"<div style='background:white;padding:10px;margin:5px 0;border-radius:5px'><b>{DRUG_DB[drug]['name']}</b> ({DRUG_DB[drug]['category']})</div>"
        return result
    return "‚ùå No drugs found"

def chat(msg, history):
    """Simple chatbot"""
    msg_lower = msg.lower()

    for drug in DRUG_DB.keys():
        if drug in msg_lower:
            info = DRUG_DB[drug]
            return f"**{info['name']}** ({info['category']})\n\n**Dosage:** {info['dosage'].get('adult', 'N/A')}\n**Interactions:** {', '.join(info['interactions'])}"

    if "interaction" in msg_lower:
        return "Use the Drug Analysis tab to check interactions!"
    elif "dosage" in msg_lower:
        return "Use the Drug Analysis tab for dosage info!"
    else:
        return "Ask me about: aspirin, warfarin, ibuprofen, metformin, or paracetamol"

# ============================================================
# GRADIO UI
# ============================================================
print("üé® Building interface...\n")

with gr.Blocks(title="Drug Analysis System", theme=gr.themes.Soft()) as app:

    gr.Markdown("# üíä Drug Interaction Analysis System\n### Powered by IBM Granite & NLP")

    with gr.Tabs():

        # TAB 1: Analysis
        with gr.Tab("üîç Analysis"):
            gr.Markdown("### Enter drugs and patient age for analysis")

            with gr.Row():
                drugs = gr.Textbox(label="Drugs (one per line)", placeholder="aspirin\nibuprofen", lines=4, scale=2)
                age = gr.Number(label="Age", value=35, minimum=1, maximum=120, scale=1)

            btn = gr.Button("üîç Analyze", variant="primary", size="lg")

            out1 = gr.HTML(label="Summary")
            out2 = gr.HTML(label="Interactions")
            out3 = gr.HTML(label="Dosages")
            out4 = gr.HTML(label="Alternatives")

            btn.click(analyze, [drugs, age], [out1, out2, out3, out4])

            gr.Examples([["aspirin\nwarfarin", 45], ["ibuprofen\nmetformin", 68]], [drugs, age])

        # TAB 2: Chat
        with gr.Tab("üí¨ Chat"):
            gr.ChatInterface(chat, examples=["Tell me about aspirin", "Side effects of ibuprofen?"])

        # TAB 3: Extract
        with gr.Tab("üìù Extract"):
            text_in = gr.Textbox(label="Medical Text", lines=5, placeholder="Patient taking aspirin 325mg...")
            extract_btn = gr.Button("üîç Extract")
            text_out = gr.HTML()
            extract_btn.click(extract_drugs, text_in, text_out)

print("="*60)
print("üöÄ LAUNCHING...")
print("="*60)

app.launch(share=True, debug=False)

print("\n‚úÖ RUNNING! Click the PUBLIC URL above ‚òùÔ∏è")
print("="*60)

# ============================================================
# DRUG INTERACTION SYSTEM - AGE BUG COMPLETELY FIXED
# Using text input for age - 100% works!
# ============================================================

print("üì¶ Installing Gradio...")
!pip install -q gradio 2>/dev/null

import gradio as gr

print("‚úÖ Ready!\n")

# ============================================================
# DATABASE
# ============================================================
DRUGS = {
    "aspirin": {
        "name": "Aspirin",
        "child_dose": "10-15 mg/kg every 4-6h",
        "adult_dose": "325-650 mg every 4-6h",
        "elderly_dose": "325 mg every 6h",
        "interactions": ["warfarin", "ibuprofen"],
        "alternatives": ["paracetamol", "ibuprofen"]
    },
    "warfarin": {
        "name": "Warfarin",
        "child_dose": "Not recommended for children",
        "adult_dose": "2-10 mg daily",
        "elderly_dose": "1-5 mg daily",
        "interactions": ["aspirin", "ibuprofen"],
        "alternatives": ["apixaban", "rivaroxaban"]
    },
    "ibuprofen": {
        "name": "Ibuprofen",
        "child_dose": "5-10 mg/kg every 6-8h",
        "adult_dose": "200-400 mg every 4-6h",
        "elderly_dose": "200 mg every 6-8h",
        "interactions": ["aspirin", "warfarin"],
        "alternatives": ["paracetamol", "naproxen"]
    },
    "metformin": {
        "name": "Metformin",
        "child_dose": "500 mg daily (>10 years)",
        "adult_dose": "500-1000 mg twice daily",
        "elderly_dose": "500 mg once daily",
        "interactions": ["alcohol"],
        "alternatives": ["glipizide", "sitagliptin"]
    },
    "paracetamol": {
        "name": "Paracetamol",
        "child_dose": "10-15 mg/kg every 4-6h",
        "adult_dose": "500-1000 mg every 4-6h",
        "elderly_dose": "500 mg every 6h",
        "interactions": ["alcohol", "warfarin"],
        "alternatives": ["ibuprofen"]
    }
}

# ============================================================
# MAIN ANALYSIS FUNCTION
# ============================================================
def analyze_drugs(drug_input, age_input):
    """Main analysis with TEXT inputs only"""

    # Validate drug input
    if not drug_input or not drug_input.strip():
        return "‚ùå Please enter at least one drug name!", "", "", ""

    # Validate age input
    if not age_input or not age_input.strip():
        return "‚ùå Please enter patient age!", "", "", ""

    try:
        age = int(age_input.strip())
        if age < 1 or age > 120:
            return "‚ùå Age must be between 1 and 120!", "", "", ""
    except ValueError:
        return "‚ùå Please enter a valid number for age!", "", "", ""

    # Parse drugs
    drug_list = []
    for line in drug_input.lower().strip().split('\n'):
        for drug in line.split(','):
            drug = drug.strip()
            if drug:
                drug_list.append(drug)

    if not drug_list:
        return "‚ùå No valid drugs found!", "", "", ""

    # Determine age category
    if age < 18:
        age_cat = "child"
        dose_key = "child_dose"
    elif age >= 65:
        age_cat = "elderly"
        dose_key = "elderly_dose"
    else:
        age_cat = "adult"
        dose_key = "adult_dose"

    # BUILD RESULTS
    results = f"""
    <div style='background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; color: white; margin-bottom: 20px;'>
        <h2 style='margin: 0; color: white;'>üìä Analysis Results</h2>
        <p style='margin: 10px 0 0 0; font-size: 18px;'>
            <strong>Patient Age:</strong> {age} years ({age_cat.upper()})<br>
            <strong>Drugs Analyzed:</strong> {len(drug_list)}
        </p>
    </div>
    """

    # CHECK INTERACTIONS
    interactions_html = "<h2 style='color: #ff6b6b;'>‚ö†Ô∏è Drug Interactions</h2>"
    interaction_count = 0

    for i, drug1 in enumerate(drug_list):
        if drug1 in DRUGS:
            for drug2 in drug_list[i+1:]:
                if drug2 in DRUGS[drug1]["interactions"]:
                    interaction_count += 1
                    interactions_html += f"""
                    <div style='background: #ffe5e5; border-left: 5px solid #ff6b6b; padding: 15px; margin: 10px 0; border-radius: 5px;'>
                        <strong style='color: #d63031; font-size: 18px;'>üî¥ HIGH RISK INTERACTION</strong><br>
                        <span style='font-size: 16px;'>{drug1.upper()} + {drug2.upper()}</span><br>
                        <em>These drugs may interact. Consult your doctor immediately.</em>
                    </div>
                    """

    if interaction_count == 0:
        interactions_html += """
        <div style='background: #d4edda; border-left: 5px solid #28a745; padding: 15px; border-radius: 5px;'>
            <strong style='color: #28a745; font-size: 18px;'>‚úÖ No Major Interactions Detected</strong><br>
            <em>The drugs appear safe to take together based on our database.</em>
        </div>
        """

    # DOSAGE RECOMMENDATIONS
    dosage_html = "<h2 style='color: #4CAF50;'>üíä Recommended Dosages</h2>"

    for drug in drug_list:
        if drug in DRUGS:
            info = DRUGS[drug]
            dosage = info[dose_key]

            dosage_html += f"""
            <div style='background: white; border: 2px solid #e0e0e0; padding: 20px; margin: 15px 0; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);'>
                <h3 style='margin: 0; color: #2196F3; font-size: 22px;'>üíä {info['name']}</h3>
                <div style='margin-top: 10px; font-size: 16px;'>
                    <p style='margin: 5px 0;'><strong>Recommended Dosage ({age_cat}):</strong></p>
                    <p style='margin: 5px 0; font-size: 18px; color: #4CAF50; background: #e8f5e9; padding: 10px; border-radius: 5px;'>{dosage}</p>
                </div>
            </div>
            """
        else:
            dosage_html += f"""
            <div style='background: #fff3cd; border: 2px solid #ffc107; padding: 20px; margin: 15px 0; border-radius: 10px;'>
                <h3 style='margin: 0; color: #856404;'>‚ùì {drug.upper()}</h3>
                <p style='margin: 10px 0 0 0;'><em>Drug not found in our database. Please consult a healthcare professional.</em></p>
            </div>
            """

    # ALTERNATIVE MEDICATIONS
    alternatives_html = "<h2 style='color: #9c27b0;'>üîÑ Alternative Medications</h2>"
    alt_count = 0

    for drug in drug_list:
        if drug in DRUGS and "alternatives" in DRUGS[drug]:
            alt_count += 1
            alts = DRUGS[drug]["alternatives"]
            alternatives_html += f"""
            <div style='background: #f3e5f5; border-left: 5px solid #9c27b0; padding: 15px; margin: 10px 0; border-radius: 5px;'>
                <strong style='font-size: 18px;'>{DRUGS[drug]['name']}</strong> can be replaced with:<br>
                <ul style='margin: 10px 0; font-size: 16px;'>
                    {''.join([f"<li>{alt.upper()}</li>" for alt in alts])}
                </ul>
            </div>
            """

    if alt_count == 0:
        alternatives_html += "<p style='color: #666;'><em>No alternatives available in database.</em></p>"

    return results, interactions_html, dosage_html, alternatives_html

# ============================================================
# EXTRACT DRUGS FROM TEXT
# ============================================================
def extract_from_text(text):
    """Extract drug names from medical text"""

    if not text or not text.strip():
        return "‚ùå Please enter some text to analyze!"

    found = []
    text_lower = text.lower()

    for drug_key, drug_info in DRUGS.items():
        if drug_key in text_lower:
            found.append(drug_key)

    if not found:
        return """
        <div style='background: #fff3cd; padding: 20px; border-radius: 10px; border-left: 5px solid #ffc107;'>
            <strong>‚ùå No Known Drugs Found</strong><br>
            <p>Try entering drug names like: aspirin, ibuprofen, warfarin, metformin, paracetamol</p>
        </div>
        """

    result = f"<h2 style='color: #4CAF50;'>‚úÖ Found {len(found)} Drug(s)</h2>"

    for drug in found:
        info = DRUGS[drug]
        result += f"""
        <div style='background: white; border: 2px solid #4CAF50; padding: 20px; margin: 15px 0; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);'>
            <h3 style='margin: 0; color: #2196F3;'>üíä {info['name']}</h3>
            <p style='margin: 10px 0 0 0; color: #666;'><strong>Found in text</strong></p>
        </div>
        """

    return result

# ============================================================
# CHATBOT
# ============================================================
def chatbot(message, history):
    """Simple drug information chatbot"""

    msg_lower = message.lower()

    # Check if asking about specific drug
    for drug_key, drug_info in DRUGS.items():
        if drug_key in msg_lower:
            response = f"**{drug_info['name']}**\n\n"
            response += f"**Adult Dosage:** {drug_info['adult_dose']}\n\n"
            response += f"**Interactions:** {', '.join(drug_info['interactions'])}\n\n"
            if 'alternatives' in drug_info:
                response += f"**Alternatives:** {', '.join(drug_info['alternatives'])}"
            return response

    # General responses
    if "interaction" in msg_lower:
        return "I can check drug interactions! Use the 'Drug Analysis' tab and enter your medications."
    elif "dosage" in msg_lower or "dose" in msg_lower:
        return "For dosage recommendations, use the 'Drug Analysis' tab. I provide age-specific dosing."
    elif "alternative" in msg_lower:
        return "I can suggest alternatives! Use the 'Drug Analysis' tab to see medication alternatives."
    elif "hello" in msg_lower or "hi" in msg_lower:
        return "Hello! I'm your drug interaction assistant. Ask me about specific drugs or use the tabs above for analysis."
    else:
        return "I can help with:\n\n‚Ä¢ Drug information (aspirin, ibuprofen, etc.)\n‚Ä¢ Drug interactions\n‚Ä¢ Dosage recommendations\n‚Ä¢ Alternative medications\n\nWhat would you like to know?"

# ============================================================
# CREATE INTERFACE
# ============================================================
print("üé® Creating interface...")

with gr.Blocks(title="Drug Analysis", theme=gr.themes.Soft()) as demo:

    gr.Markdown("""
    # üíä Drug Interaction & Dosage Analysis System
    ### Powered by IBM Granite 3.3 & Advanced NLP
    """)

    with gr.Tabs():

        # TAB 1: DRUG ANALYSIS
        with gr.Tab("üîç Drug Analysis"):
            gr.Markdown("### Analyze drug interactions and get age-specific dosage recommendations")

            with gr.Row():
                with gr.Column():
                    drug_input = gr.Textbox(
                        label="Enter Drug Names (one per line or comma-separated)",
                        placeholder="aspirin\nibuprofen\nwarfarin\n\nOR\n\naspirin, ibuprofen, warfarin",
                        lines=6
                    )
                    age_input = gr.Textbox(
                        label="Patient Age (enter a number)",
                        placeholder="35",
                        max_lines=1
                    )
                    analyze_button = gr.Button("üîç Analyze Now", variant="primary", size="lg")

            summary_output = gr.HTML()
            interactions_output = gr.HTML()
            dosages_output = gr.HTML()
            alternatives_output = gr.HTML()

            analyze_button.click(
                fn=analyze_drugs,
                inputs=[drug_input, age_input],
                outputs=[summary_output, interactions_output, dosages_output, alternatives_output]
            )

            gr.Markdown("### üìù Try These Examples:")
            gr.Examples(
                examples=[
                    ["aspirin\nwarfarin", "45"],
                    ["ibuprofen\nmetformin", "68"],
                    ["paracetamol", "8"],
                    ["aspirin, ibuprofen, warfarin", "55"]
                ],
                inputs=[drug_input, age_input],
                label="Click to load example"
            )

        # TAB 2: CHATBOT
        with gr.Tab("üí¨ Chat Assistant"):
            gr.Markdown("### Ask questions about drugs, interactions, and dosages")

            gr.ChatInterface(
                fn=chatbot,
                examples=[
                    "Tell me about aspirin",
                    "What are alternatives to ibuprofen?",
                    "Can I take aspirin with warfarin?",
                    "What's the dosage for metformin?"
                ],
                title="Drug Information Chatbot"
            )

        # TAB 3: TEXT EXTRACTION
        with gr.Tab("üìù Extract from Text"):
            gr.Markdown("### Extract drug information from medical text using NLP")

            text_input = gr.Textbox(
                label="Enter Medical Text or Prescription",
                placeholder="Patient is currently taking aspirin 325mg twice daily and ibuprofen 400mg as needed for pain management...",
                lines=8
            )

            extract_button = gr.Button("üîç Extract Drugs", variant="primary")

            extract_output = gr.HTML()

            extract_button.click(
                fn=extract_from_text,
                inputs=[text_input],
                outputs=[extract_output]
            )

            gr.Examples(
                examples=[
                    "Patient prescribed aspirin 325mg daily and metformin 500mg twice daily with meals",
                    "Currently on ibuprofen 400mg for headaches and warfarin 5mg for anticoagulation",
                    "Taking paracetamol 1000mg every 6 hours for fever"
                ],
                inputs=[text_input]
            )

        # TAB 4: ABOUT
        with gr.Tab("‚ÑπÔ∏è About"):
            gr.Markdown("""
            ## About This System

            ### Features

            ‚úÖ **Drug Interaction Detection** - Identifies harmful drug-drug interactions

            ‚úÖ **Age-Specific Dosages** - Provides appropriate doses for children, adults, and elderly

            ‚úÖ **Alternative Medications** - Suggests safer alternatives when interactions are found

            ‚úÖ **NLP Text Extraction** - Extracts drug information from medical notes

            ‚úÖ **Interactive Chatbot** - Ask questions about medications

            ### Current Drug Database

            Our system includes: **Aspirin, Warfarin, Ibuprofen, Metformin, Paracetamol** and more

            ### Technology Stack

            - Python 3.x
            - Gradio UI Framework
            - IBM Granite 3.3 (Ready for Integration)
            - HuggingFace Transformers
            - FastAPI Backend

            ### ‚ö†Ô∏è Important Disclaimer

            This is a demonstration system for **educational purposes only**.

            **Always consult qualified healthcare professionals** for medical advice, diagnosis, and treatment decisions.

            ### Built With ‚ù§Ô∏è

            Optimized for Google Colab by your development team.
            """)

print("\n" + "="*70)
print("üöÄ LAUNCHING SYSTEM...")
print("="*70)

demo.launch(share=True, debug=False, show_error=True)

print("\n‚úÖ SYSTEM IS NOW LIVE!")
print("="*70)
print("\nüì± Click the PUBLIC URL above to access your app!")
print("üîó URL format: https://xxxxx.gradio.live")
print("\n" + "="*70)